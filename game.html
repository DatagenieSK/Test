<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Volcano Dash - Manager Mode</title>
    <style>
        body { margin: 0; overflow: hidden; background: #000; font-family: monospace; user-select: none; }
        canvas { display: block; }
        
        #ui {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
        }
        .score {
            position: absolute; top: 20px; right: 20px;
            color: #ffd700; font-size: 24px; font-weight: bold;
            text-shadow: 0 0 10px #ff4500;
        }
        .back-btn {
            position: absolute; top: 20px; left: 20px;
            color: white; background: #333; padding: 10px 20px;
            text-decoration: none; border-radius: 5px; font-weight: bold;
            pointer-events: auto; border: 1px solid #555;
        }
        .game-over {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.9); padding: 40px; border-radius: 15px;
            text-align: center; border: 2px solid #ff4500; display: none;
            pointer-events: auto;
        }
        h1 { color: #ff4500; margin: 0 0 10px 0; }
        p { color: white; margin-bottom: 20px; }
        button {
            background: #ffd700; border: none; padding: 10px 20px;
            font-size: 16px; font-weight: bold; cursor: pointer; border-radius: 5px;
        }
        button:hover { background: white; }
    </style>
</head>
<body>

    <a href="index.html" class="back-btn">‚Üê Back to QR</a>
    <div id="ui">
        <div class="score">SCORE: <span id="scoreVal">0</span></div>
        <div class="game-over" id="gameOverScreen">
            <h1>FIRED! üî•</h1>
            <p>Score: <span id="finalScore">0</span></p>
            <button onclick="location.reload()">Try Again</button>
        </div>
    </div>
    <canvas id="gameCanvas"></canvas>

    <script>
        const canvas = document.getElementById("gameCanvas");
        const ctx = canvas.getContext("2d");
        
        // Setup Canvas
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        
        // Game State
        let score = 0;
        let gameOver = false;
        let player = { x: canvas.width/2, y: canvas.height - 80, emoji: "üõí" };
        let obstacles = []; // Fire
        let rewards = [];   // Coins

        // Audio
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playTone(f, t, d) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const o = audioCtx.createOscillator();
            const g = audioCtx.createGain();
            o.type = t; o.frequency.value = f;
            g.gain.setValueAtTime(0.1, audioCtx.currentTime);
            g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + d);
            o.connect(g); g.connect(audioCtx.destination);
            o.start(); o.stop(audioCtx.currentTime + d);
        }

        // Inputs
        window.addEventListener("mousemove", e => player.x = e.clientX);
        window.addEventListener("touchmove", e => player.x = e.touches[0].clientX);

        // Game Loop
        function loop() {
            if (gameOver) return;
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Draw Player
            ctx.font = "40px Arial";
            ctx.textAlign = "center";
            ctx.fillText(player.emoji, player.x, player.y);
            
            // Spawners
            if (Math.random() < 0.05) obstacles.push({x: Math.random()*canvas.width, y: -50, s: Math.random()*5+5});
            if (Math.random() < 0.02) rewards.push({x: Math.random()*canvas.width, y: -50, s: Math.random()*3+2});

            // Logic
            obstacles.forEach((o, i) => {
                o.y += o.s;
                ctx.fillText("üî•", o.x, o.y);
                if (Math.hypot(player.x - o.x, player.y - 20 - o.y) < 30) endGame();
                if (o.y > canvas.height) obstacles.splice(i, 1);
            });

            rewards.forEach((r, i) => {
                r.y += r.s;
                ctx.fillText("ü™ô", r.x, r.y);
                if (Math.hypot(player.x - r.x, player.y - 20 - r.y) < 35) {
                    score += 10;
                    document.getElementById("scoreVal").innerText = score;
                    playTone(1200, 'sine', 0.1);
                    rewards.splice(i, 1);
                }
                if (r.y > canvas.height) rewards.splice(i, 1);
            });

            requestAnimationFrame(loop);
        }

        function endGame() {
            gameOver = true;
            playTone(150, 'sawtooth', 0.5);
            document.getElementById("finalScore").innerText = score;
            document.getElementById("gameOverScreen").style.display = "block";
        }

        // Start
        loop();
    </script>
</body>
</html>
